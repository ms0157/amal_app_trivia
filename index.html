<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כלי למידה אינטראקטיבי לפרויקט טריוויה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f7f9fc;
        }
        /* הגדרת כיווניות לקוד ל-LTR בלבד */
        .step-code {
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.5;
            background-color: #1e1e1e; /* Dark background for code */
            color: #d4d4d4; /* Light text color */
            text-align: left; /* כיווניות טקסט משמאל לימין */
        }
        .active-step {
            background-color: #dbeafe !important;
            border-right: 4px solid #3b82f6;
            font-weight: 700;
        }
        /* Custom scrollbar for aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
        }
    </style>
</head>
<body class="text-right">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3b82f6',
                        'secondary-gray': '#e5e7eb',
                    }
                }
            }
        }

        // --- בסיס נתונים לצעדים ---
        // הנתונים מבוססים על הקבצים "טריוויה - חלק 1-בסיסי.csv", "טריוויה - חלק 2-מסד נתונים.csv", "טריוויה - חלק 3-הרחבות.csv"
        const stepsData = [
            // --- חלק 1: בסיסי ואביזרים ---
            { 
                id: 'p1_s1', 
                part: '1', 
                title: 'מסך ראשי עם תמונה ו-FAB', 
                concept: 'מבוא למסכים ואלמנטים ויזואליים. הצגת תמונה (ImageView) משפרת את ממשק המשתמש (UI/UX) ומוסיפה חוויה ויזואלית. FAB (כפתור פעולה צף) מספק גישה מהירה לפעולה המרכזית.', 
                code: `// מיקום: MainActivity.java
public void init() {
    // 1. קישור רכיבים מה-XML
    imageViewLogo = findViewById(R.id.imageViewLogo); // הנחה שיש ImageView עם ID זה ב-activity_main.xml
    fab = findViewById(R.id.fabStart);
    
    // 2. הגדרת מאזין ל-FAB
    fab.setOnClickListener(new View.OnClickListener() {
        @Override
        public void onClick(View view) {
            // מעבר למסך ההתחברות/המשחק
            Intent intent = new Intent(MainActivity.this, LoginActivity.class);
            startActivity(intent);
        }
    });
    // ...
}`,
                examTips: [
                    'כיצד קישרת בין הרכיבים הוויזואליים ב-XML לקוד ה-Java? (הסבר על findViewById).',
                    'מדוע בחרת להשתמש ב-ImageView במקום ברכיב אחר (כמו TextView או Lottie)?',
                    'מהו FAB ומה תפקידו באפליקציה שלך? כיצד הוא תורם ל-UI/UX?'
                ]
            },
            { 
                id: 'p1_s9', 
                part: '1', 
                title: 'שמירת נתונים ב-Shared Preferences', 
                concept: 'שימוש ב-**SharedPreferences** הוא הרחבה חשובה. זו הדרך הפשוטה והקלה ביותר לשמור נתונים קטנים (כמו הגדרות או ציון אחרון) באופן פרטי במכשיר. **למה?** כי אין צורך במסד נתונים מלא לנתונים פשוטים, וזה מהיר מאוד.', 
                code: `// מיקום: LoginActivity.java (לשמירת משתמש מחובר) / GameActivity.java (לשמירת ציון אחרון)
// --- שמירת נתון (לדוגמה, שם משתמש) ---
SharedPreferences sp = getSharedPreferences("userDetails", MODE_PRIVATE);
SharedPreferences.Editor editor = sp.edit();
editor.putString("loggedInEmail", userEmail);
editor.putBoolean("isLoggedIn", true);
editor.apply(); // עדיף: כתיבה א-סינכרונית

// --- קריאת נתון ---
String savedEmail = sp.getString("loggedInEmail", "guest");
boolean wasLoggedIn = sp.getBoolean("isLoggedIn", false);` ,
                examTips: [
                    'מה ההבדל המהותי בין שימוש ב-SharedPreferences לבין שימוש ב-SQLite? מתי תבחר בכל אחד מהם?',
                    'מהי המשמעות של MODE_PRIVATE? האם אפשר לשמור נתונים ציבוריים?',
                    'הסבר את ההבדל בין apply() לבין commit(). מדוע apply() עדיף ברוב המקרים?'
                ]
            },
            { 
                id: 'p1_s18', 
                part: '1', 
                title: 'הוספת תפריט (Options Menu)', 
                concept: 'התפריט מאפשר גישה לפעולות משניות (כגון הגדרות, אודות, הנחיות) מבלי להעמיס על המסך הראשי. **למה?** שיפור ניווט וארגון הפעולות. יש להבין את המתודות onCreateOptionsMenu ו-onOptionsItemSelected.', 
                code: `// מיקום: MainActivity.java (או כל Activity שבו רוצים תפריט)
// *** נדרש קובץ res/menu/main_menu.xml ***
@Override
public boolean onCreateOptionsMenu(Menu menu) {
    // טוען את קובץ ה-XML של התפריט
    getMenuInflater().inflate(R.menu.main_menu, menu);
    return true; // חייב להחזיר true כדי שהתפריט יוצג
}

@Override
public boolean onOptionsItemSelected(@NonNull MenuItem item) {
    int itemId = item.getItemId();
    
    // בדיקה איזה פריט נבחר
    if (itemId == R.id.mnuInstructions) {
        // מעבר למסך הנחיות באמצעות Intent
        Intent intent = new Intent(MainActivity.this, InstructionsActivity.class);
        startActivity(intent);
        return true;
    }
    // ... טיפול בפריטים נוספים (Settings, About)
    return super.onOptionsItemSelected(item);
}`,
                examTips: [
                    'מהם שני המתודות שחייבים לממש כדי ליצור תפריט? מה תפקידו של כל אחד מהם?',
                    'כיצד ידעת לאיזה Activity לעבור כאשר המשתמש לחץ על כפתור בתפריט? (הסבר על Intent).',
                    'מה יקרה אם onCreateOptionsMenu יחזיר false?'
                ]
            },
            { 
                id: 'p1_s19', 
                part: '1', 
                title: 'קריאת הנחיות מקובץ גולמי (Raw Resource)', 
                concept: '**Raw Resources** - זו דרך קלה לשלב קבצים סטטיים (טקסט, מוזיקה) בתוך האפליקציה. **למה?** קובץ טקסט גולמי (R.raw.instructions) מאפשר לשמור תוכן גדול (כמו הנחיות למשתמש) בנפרד מהקוד, ולקרוא אותו בקלות לתוך TextView.', 
                code: `// מיקום: InstructionsActivity.java
// *** נדרש קובץ res/raw/instructions.txt ***
public String readIntroductionsFromFile() {
    try {
        // פתיחת זרם קריאה לקובץ (Instructions)
        InputStream is = getResources().openRawResource(R.raw.instructions);
        InputStreamReader isr = new InputStreamReader(is);
        BufferedReader br = new BufferedReader(isr);
        
        StringBuilder all = new StringBuilder();
        String line;
        
        // קריאה שורה אחר שורה
        while ((line = br.readLine()) != null) {
            all.append(line).append("\\n");
        }
        
        // סגירת משאבים (חובה!)
        br.close();
        isr.close();
        is.close();
        return all.toString();
        
    } catch (IOException e) {
        // טיפול בשגיאה
        e.printStackTrace();
        return "שגיאה בטעינת הנחיות: " + e.getMessage();
    }
}`,
                examTips: [
                    'מהו ההבדל בין קריאת קובץ מ-raw לבין קריאת קובץ מ-Assets? מתי תבחר בכל אחד מהם?',
                    'מדוע חשוב להשתמש ב-try-catch מסביב לפעולות I/O? אילו שגיאות יכולות לקרות?',
                    'הסבר את שרשרת הזרמים (InputStream -> InputStreamReader -> BufferedReader). מדוע משתמשים ב-BufferedReader?'
                ]
            },

            // --- חלק 2: מסד נתונים SQLite ---
            { 
                id: 'p2_s2', 
                part: '2', 
                title: 'יצירת מחלקת עזר HelperDB', 
                concept: 'מחלקת ה-**SQLiteOpenHelper** היא **המתווך** בין האפליקציה למסד הנתונים. **למה?** היא מנהלת את יצירת מסד הנתונים הראשונית (onCreate) ואת עדכון המבנה שלו בעת הצורך (onUpgrade). היא מבטיחה שהאפליקציה תעבוד עם מבנה נתונים יציב.', 
                code: `// מיקום: HelperDB.java
public class HelperDB extends SQLiteOpenHelper {
    private static final String DATABASE_NAME = "TriviaDB.db";
    private static final int DATABASE_VERSION = 1; // חשוב!

    public HelperDB(Context context) {
        // קונסטרקטור המקשר לקובץ הפיזי של מסד הנתונים
        super(context, DATABASE_NAME, null, DATABASE_VERSION);
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        // יצירת טבלת המשתמשים (מתבצעת רק בפעם הראשונה)
        String createTableUsers = "CREATE TABLE " + USERS_TABLE + " (" +
                                  EMAIL_COL + " TEXT PRIMARY KEY, " +
                                  FIRST_NAME_COL + " TEXT, " +
                                  PASSWORD_COL + " TEXT " +
                                  ");";
        db.execSQL(createTableUsers);
        // ... יצירת טבלת ציונים
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        // נדרש בעת עדכון גרסה של האפליקציה
        db.execSQL("DROP TABLE IF EXISTS " + USERS_TABLE);
        onCreate(db); // יצירת הטבלאות מחדש
    }
}`,
                examTips: [
                    'מה תפקידה של מחלקת HelperDB? למה לא לבצע את שאילתות ה-SQL ישירות ב-Activity?',
                    'מתי בדיוק נקראת המתודה onCreate? ומתי נקראת המתודה onUpgrade?',
                    'הסבר את השימוש ב-PRIMARY KEY בטבלת המשתמשים. מה זה מבטיח? האם יכולה להיות כפילות?'
                ]
            },
            { 
                id: 'p2_s3', 
                part: '2', 
                title: 'רישום משתמש באמצעות מסד נתונים', 
                concept: 'הוספת רשומת משתמש חדשה לטבלת המשתמשים. **למה?** השתמש ב-**ContentValues** כדי להבטיח אבטחה (מניעת SQL Injection) ונוחות בבניית השאילתה. זו הדרך המקובלת לשמירת נתונים ב-SQLite.', 
                code: `// מיקום: RegisterActivity.java (בתוך מתודת הרישום)
public void registerUser(UserProperties user) {
    // קבלת אובייקט ה-DB במצב כתיבה
    SQLiteDatabase db = helperDB.getWritableDatabase(); 
    
    // ContentValues: מפה של עמודות וערכים להכנסה
    ContentValues cv = new ContentValues();
    cv.put(HelperDB.EMAIL_COL, user.getEmail());
    cv.put(HelperDB.FIRST_NAME_COL, user.getFirstName());
    cv.put(HelperDB.PASSWORD_COL, user.getPassword());
    // ... הוספת שאר הנתונים

    // ביצוע ההכנסה לטבלה
    long newRowId = db.insert(HelperDB.USERS_TABLE, null, cv);
    
    if (newRowId == -1) {
        // הצגת הודעה: אירעה שגיאה או שהמשתמש כבר קיים
        Toast.makeText(this, "שגיאה ברישום, המייל כבר קיים", Toast.LENGTH_SHORT).show();
    } else {
        // הצגת הודעה: רישום מוצלח
        Toast.makeText(this, "הרישום בוצע בהצלחה", Toast.LENGTH_SHORT).show();
    }
}` ,
                examTips: [
                    'מהו ContentValues וכיצד הוא תורם לאבטחת הקוד שלך בעת הכנסת נתונים? (הגן מפני SQL Injection).',
                    'מה מחזירה הפעולה db.insert() במקרה של הצלחה או כישלון? כיצד אתה משתמש בערך זה?',
                    'האם אתה מבצע בדיקת תקינות נתונים (כגון אורך סיסמה, פורמט מייל) לפני קריאה ל-db.insert()?'
                ]
            },
            { 
                id: 'p2_s5', 
                part: '2', 
                title: 'בדיקת התחברות משתמש', 
                concept: 'שליפת נתונים ובדיקת תנאי התאמה. **למה?** יש להשתמש ב-**Cursor** כדי לעבור על התוצאות שהתקבלו מהשאילתה. **חשוב:** שימוש ב-`?` ב-`selectionArgs` מגן מפני SQL Injection ומבטיח שהקלט של המשתמש יטופל כערך ולא כחלק מהפקודה.', 
                code: `// מיקום: LoginActivity.java (או כמתודה בתוך HelperDB)
public UserProperties checkLogin(String email, String password) {
    SQLiteDatabase db = helperDB.getReadableDatabase();
    
    // הגדרת תנאי ה-WHERE בצורה מאובטחת
    String selection = HelperDB.EMAIL_COL + "=? AND " + HelperDB.PASSWORD_COL + "=?";
    String[] selectionArgs = {email, password}; // ערכים להחלפת ה-?
    
    Cursor cursor = db.query(
        HelperDB.USERS_TABLE, // הטבלה
        null, // columns: כל העמודות
        selection, // תנאי WHERE
        selectionArgs, // ערכי ה-WHERE
        null, null, null // group by, having, order by
    );

    if (cursor.moveToFirst()) { // אם נמצאה שורה
        // המשתמש נמצא, בצע שליפת נתונים ובניית אובייקט
        String firstName = cursor.getString(cursor.getColumnIndexOrThrow(HelperDB.FIRST_NAME_COL));
        cursor.close();
        return new UserProperties(email, firstName, password);
    }
    
    cursor.close(); // סגירת המצביע - חובה!
    return null; // משתמש לא נמצא
}` ,
                examTips: [
                    'מה תפקידו של ה-Cursor בקריאת נתונים? מדוע חשוב לסגור אותו באמצעות cursor.close()?',
                    'הסבר את מנגנון ההגנה מפני SQL Injection בקוד זה (שימוש ב-selectionArgs).',
                    'מה יקרה אם לא תשתמש במתודה moveToFirst()?'
                ]
            },
            { 
                id: 'p2_s10', 
                part: '2', 
                title: 'מחיקת משתמש', 
                concept: 'מחיקת רשומה מטבלת המשתמשים. **למה?** כדי לאפשר למשתמש שליטה מלאה בנתונים שלו (דרישת פרטיות). יש להשתמש בפקודת db.delete() ולציין את תנאי המחיקה (WHERE). רצוי להשתמש בדיאלוג אישור (AlertDialog) לפני המחיקה.', 
                code: `// מיקום: UserSettingsActivity.java (מתודת deleteUser)
public void deleteUser(String email) {
    SQLiteDatabase db = helperDB.getWritableDatabase();
    
    String where = HelperDB.EMAIL_COL + "=?";
    String[] args = new String[]{email}; // המייל של המשתמש המחובר

    // 1. מחיקה מטבלת הציונים (חובה כדי למנוע נתונים יתומים!)
    int scoresDeleted = db.delete(HelperDB.SCORES_TABLE, where, args);

    // 2. מחיקה מטבלת המשתמשים
    int usersDeleted = db.delete(HelperDB.USERS_TABLE, where, args);

    if (usersDeleted > 0) {
        Toast.makeText(this, "המשתמש נמחק בהצלחה", Toast.LENGTH_SHORT).show();
        // Intent חזרה למסך ההתחברות
    } else {
        Toast.makeText(this, "שגיאה במחיקה", Toast.LENGTH_SHORT).show();
    }
}` ,
                examTips: [
                    'מדוע חשוב למחוק תחילה את הרשומות מטבלת הציונים (SCORES_TABLE) ולאחר מכן את המשתמש מטבלת המשתמשים? (הסבר על Foreign Keys).',
                    'באיזה מנגנון אתה משתמש כדי לבקש אישור מהמשתמש לפני המחיקה? (AlertDialog, TextToSpeech וכו\').',
                    'מה תפקידו של where ב-db.delete()? ומה יקרה אם תחסיר אותו?'
                ]
            },

            // --- חלק 3: הרחבות ושיפורים ---
            { 
                id: 'p3_s1', 
                part: '3', 
                title: 'הרחבה: TextToSpeech (אישור קולי)', 
                concept: '**TextToSpeech (TTS)** זו הרחבה המשתמשת בשירות מערכת כדי להפוך טקסט לדיבור. **למה?** זו הרחבה חזקה המשתמשת ב-API חיצוני, מוסיפה נגישות ומקלה על אישור פעולות (כמו מחיקת משתמש), במיוחד כאשר הטקסט ארוך.', 
                code: `// מיקום: UserSettingsActivity.java
public TextToSpeech textToSpeech;
public Locale locale;

// --- אתחול (ב-onCreate) ---
textToSpeech = new TextToSpeech(getApplicationContext(), new TextToSpeech.OnInitListener() {
    @Override
    public void onInit(int status) {
        if (status == TextToSpeech.SUCCESS) {
            locale = new Locale("iw"); // הגדרת עברית ("iw")
            int lang = textToSpeech.setLanguage(locale);
            
            if (lang == TextToSpeech.LANG_MISSING_DATA || lang == TextToSpeech.LANG_NOT_SUPPORTED) {
                 Log.e("TTS", "השפה אינה נתמכת");
            }
        } else {
            Log.e("TTS", "אתחול TTS נכשל");
        }
    }
});

// --- שימוש (לדוגמה, במתודת המחיקה) ---
public void read(String message) {
    // השמעת ההודעה
    textToSpeech.speak(message, TextToSpeech.QUEUE_FLUSH, null, null);
}

// --- שחרור משאבים (חובה! ב-onDestroy) ---
@Override
protected void onDestroy() {
    if (textToSpeech != null) {
        textToSpeech.stop();
        textToSpeech.shutdown(); // משחרר את מנוע ה-TTS
    }
    super.onDestroy();
}` ,
                examTips: [
                    'מדוע TextToSpeech נחשבת הרחבה מתקדמת יותר (הרחבה 10)?',
                    'מה תפקידו של TextToSpeech.OnInitListener? מתי אתה יודע שמנוע ה-TTS מוכן לשימוש?',
                    'מדוע חובה לשחרר את המשאבים של TTS במתודה onDestroy? מה יקרה אם לא תעשה זאת?'
                ]
            },
            { 
                id: 'p3_s5', 
                part: '3', 
                title: 'הרחבה: הורדת שאלות מהרשת (Async Task)', 
                concept: '**Async Task** הוא מנגנון לביצוע פעולות **ארוכות** (כמו הורדת קובץ או גישה לבסיס נתונים רחוק) בחוט (Thread) נפרד מהחוט הראשי של ממשק המשתמש (UI Thread). **למה?** **אסור** לחסום את חוט הממשק הראשי! חסימה גורמת לאפליקציה "לקפוא" ול-ANR (Application Not Responding) - זהו נושא תיאורטי קריטי לבחינה!', 
                code: `// מיקום: GameActivity.java (מחלקת עזר פנימית)
private class GetQuestionsFromInternet extends AsyncTask<String, Void, String> {
    
    // --- 1. doInBackground: חוט הרקע (Background Thread) ---
    @Override
    protected String doInBackground(String... urls) {
        // *** כאן מתבצעת הפעולה החוסמת (קריאת HTTP) ***
        // אסור לעדכן UI כאן!
        // ... קוד Java.net.URL / HTTPURLConnection להורדת JSON
        String downloadedData = fetchData(urls[0]); 
        return downloadedData;
    }

    // --- 2. onPostExecute: חוט הראשי (UI Thread) ---
    @Override
    protected void onPostExecute(String result) {
        super.onPostExecute(result);
        // *** כאן מותר לעדכן את ממשק המשתמש ***
        try {
            // ניתוח JSON מתוך ה-result
            JSONArray jsonArray = new JSONArray(result); 
            // ... בניית רשימת אובייקטי Question ועדכון UI
            loadFirstQuestion();
        } catch (JSONException e) {
            Toast.makeText(GameActivity.this, "שגיאה בנתונים מהרשת", Toast.LENGTH_LONG).show();
            e.printStackTrace();
        }
    }
}` ,
                examTips: [
                    'מהי הבעיה העיקרית ש-AsyncTask בא לפתור? (ANR - Application Not Responding)',
                    'הסבר את שלושת הפרמטרים של AsyncTask. מה תפקידם?',
                    'מהו ההבדל המהותי בין doInBackground לבין onPostExecute? מדוע אסור לעדכן UI ב-doInBackground?'
                ]
            },
            { 
                id: 'p3_s4', 
                part: '3', 
                title: 'הרחבה: Broadcast Receiver (עצירת משחק בשיחה)', 
                concept: 'ה-**Broadcast Receiver** הוא מנגנון שמאפשר לאפליקציה **להאזין** לאירועים שמשודרים על ידי המערכת (כמו שיחה נכנסת, סוללה חלשה, או התחברות ל-Wi-Fi). **למה?** כדי להגיב באופן מיידי לאירועים קריטיים של המערכת. במקרה זה, עצירת משחק כשיש שיחה נכנסת משפרת את חוויית המשתמש. **דרישת חובה:** יש להגדיר את ה-Receiver במניפסט ו/או לרשום אותו דינמית.', 
                code: `// מיקום 1: MyPhoneReceiver.java (המחלקת ה-Receiver)
public class MyPhoneReceiver extends BroadcastReceiver {
    
    // נקרא בכל פעם שמתקבל אירוע שאליו המחלקה רשומה
    @Override
    public void onReceive(Context context, Intent intent) {
        // TelephonyManager.EXTRA_STATE מחזיק את מצב הטלפון
        String state = intent.getStringExtra(TelephonyManager.EXTRA_STATE);

        // אם המצב הוא שיחה נכנסת
        if (state.equals(TelephonyManager.EXTRA_STATE_RINGING)) {
            Log.d("Receiver", "שיחה נכנסת - עוצר את המשחק");
            
            // שליחת הודעה מקומית (Broadcast) למחלקת המשחק (GameActivity)
            Intent localIntent = new Intent("ACTION_PAUSE_GAME");
            LocalBroadcastManager.getInstance(context).sendBroadcast(localIntent);
        }
    }
}

// מיקום 2: AndroidManifest.xml (חובה)
// <uses-permission android:name="android.permission.READ_PHONE_STATE"/>
// <receiver android:name=".MyPhoneReceiver" android:exported="true">
//     <intent-filter>
//         <action android:name="android.intent.action.PHONE_STATE"/>
//     </intent-filter>
// </receiver>` ,
                examTips: [
                    'מהו Broadcast Receiver ומה תפקידו? תן דוגמה לאירוע מערכת נוסף שניתן להאזין לו.',
                    'מדוע נדרשת הגדרה ב-AndroidManifest.xml? איזה הרשאה נדרשת כדי לקבל מידע על שיחות?',
                    'כיצד אתה מעביר את המידע מה-Receiver (שאינו Activity) חזרה ל-GameActivity כדי לעצור את המשחק? (הסבר על LocalBroadcastManager).'
                ]
            },
        ];

        let activeStepId = stepsData[0].id;

        function loadStepDetails(stepId) {
            const step = stepsData.find(s => s.id === stepId);
            if (!step) return;

            // עדכון המשתנה הגלובלי
            activeStepId = stepId;

            document.getElementById('stepTitle').innerText = step.title;
            document.getElementById('stepConcept').innerHTML = `
                <h3 class="text-xl font-bold mb-2 text-primary-blue">הסבר קונספטואלי: למה?</h3>
                <p class="text-gray-700 leading-relaxed">${step.concept}</p>
            `;
            document.getElementById('stepCode').innerText = step.code;
            
            // עדכון הטיפים לבוחן
            const tipsContainer = document.getElementById('examTipsList');
            tipsContainer.innerHTML = ''; // ניקוי הטיפים הקודמים
            step.examTips.forEach(tip => {
                const li = document.createElement('li');
                li.className = 'text-yellow-700 list-disc list-inside';
                li.innerText = tip;
                tipsContainer.appendChild(li);
            });

            // עדכון כפתורי הניווט הפעילים
            document.querySelectorAll('.step-item').forEach(el => {
                el.classList.remove('active-step');
                if (el.dataset.stepId === stepId) {
                    el.classList.add('active-step');
                }
            });

            // במידה ואנחנו במובייל, גוללים למעלה לצפייה בפרטים
            if (window.innerWidth < 768) {
                document.getElementById('mainContent').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function copyCode() {
            const codeElement = document.getElementById('stepCode');
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                const button = document.getElementById('copyButton');
                const originalText = button.innerText;
                button.innerText = 'הועתק!';
                button.classList.add('bg-green-500', 'hover:bg-green-600');
                button.classList.remove('bg-gray-300', 'hover:bg-gray-400');
                setTimeout(() => {
                    button.innerText = originalText;
                    button.classList.remove('bg-green-500', 'hover:bg-green-600');
                    button.classList.add('bg-gray-300', 'hover:bg-gray-400');
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        function initializeApp() {
            const sidebar = document.getElementById('sidebarSteps');
            let currentPart = '';

            // יצירת רשימת הצעדים בסרגל הצד
            stepsData.forEach(step => {
                // הוספת כותרת חלק אם זהו חלק חדש
                if (step.part !== currentPart) {
                    currentPart = step.part;
                    const partHeader = document.createElement('h2');
                    partHeader.className = 'px-4 pt-4 pb-2 text-sm font-bold text-gray-800 border-t border-gray-200';
                    partHeader.innerText = `חלק ${step.part}: ${step.part === '1' ? 'בסיס ואביזרים' : step.part === '2' ? 'מסד נתונים SQLite' : 'הרחבות ושיפורים'}`;
                    sidebar.appendChild(partHeader);
                }

                const stepDiv = document.createElement('div');
                stepDiv.className = 'step-item cursor-pointer p-4 transition-all duration-200 hover:bg-gray-100 border-b border-gray-100 text-sm md:text-base';
                stepDiv.innerText = step.title;
                stepDiv.dataset.stepId = step.id;
                stepDiv.addEventListener('click', () => loadStepDetails(step.id));
                sidebar.appendChild(stepDiv);
            });

            // טעינת השלב הראשון כברירת מחדל
            if (stepsData.length > 0) {
                loadStepDetails(stepsData[0].id);
            }

            // קישור כפתור ההעתקה
            document.getElementById('copyButton').addEventListener('click', copyCode);
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

    <div class="flex flex-col md:flex-row min-h-screen">
        
        <aside id="sidebarSteps" class="w-full md:w-80 bg-white border-l border-gray-200 flex-shrink-0 custom-scrollbar overflow-y-auto">
            <header class="p-4 bg-primary-blue text-white shadow-lg sticky top-0 z-10">
                <h1 class="text-lg font-bold">📚 צעדים להבנה מלאה</h1>
                <p class="text-sm">לחץ על שלב כדי לראות קוד והסבר קונספטואלי</p>
            </header>
        </aside>

        <main id="mainContent" class="flex-grow p-6 md:p-10 custom-scrollbar overflow-y-auto">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-6">כלי הלימוד לפרויקט הטריוויה: בגרות 5 יח"ל</h1>
            <p class="text-lg text-gray-600 mb-10">כאן תוכלו לראות את הצעד המדויק, את הקוד הדרוש לו, והכי חשוב - **את ההסבר הקונספטואלי** ("למה?") כדי להיות מוכנים לבחינת ההגנה.</p>

            <div class="bg-white rounded-xl shadow-2xl overflow-hidden p-6 md:p-8 border-t-8 border-primary-blue">
                <h2 id="stepTitle" class="text-2xl md:text-3xl font-extrabold mb-4 text-gray-800"></h2>

                <div id="stepConcept" class="mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200 transition-all duration-300">
                    <!-- קונספט יוכנס כאן -->
                </div>

                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-bold text-gray-800">קוד Java: איך מבצעים?</h3>
                        <button id="copyButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-200">
                            העתק קוד
                        </button>
                    </div>
                    
                    <pre dir="ltr" class="step-code p-4 rounded-lg text-sm md:text-base overflow-x-auto shadow-inner">
                        <code id="stepCode">
                            // קוד יוכנס כאן
                        </code>
                    </pre>
                </div>
            </div>

            <div class="mt-10 p-6 bg-yellow-100 rounded-xl border border-yellow-300 shadow-lg">
                <h3 class="text-xl font-bold text-yellow-800 mb-4">💡 טיפ לבוחן: שאלות המחוון הרלוונטיות לקטע זה</h3>
                <p class="text-yellow-700">התכונן לענות על שאלות אלו כדי להפגין שליטה מלאה בחומר התיאורטי וביישום הקוד:</p>
                <ul id="examTipsList" class="list-disc list-inside mt-2 space-y-2 text-yellow-700 font-medium">
                    <!-- טיפים לשאלות יוכנסו כאן -->
                </ul>
            </div>
        </main>
    </div>
</body>
</html>
