<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כלי למידה אינטראקטיבי לפרויקט טריוויה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f7f9fc;
        }
        /* הגדרת כיווניות לקוד ל-LTR בלבד */
        .step-code {
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.5;
            background-color: #1e1e1e; /* Dark background for code */
            color: #d4d4d4; /* Light text color */
            text-align: left; /* כיווניות טקסט משמאל לימין */
        }
        .active-step {
            background-color: #dbeafe !important;
            border-right: 4px solid #3b82f6;
            font-weight: 700;
        }
        /* Custom scrollbar for aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
        }
    </style>
</head>
<body class="text-right">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3b82f6',
                        'secondary-gray': '#e5e7eb',
                    }
                }
            }
        }

        // --- בסיס נתונים לצעדים ---
        // הנתונים מבוססים על הקבצים "טריוויה - חלק 1-בסיסי.csv", "טריוויה - חלק 2-מסד נתונים.csv", "טריוויה - חלק 3-הרחבות.csv"
        const stepsData = [
            // --- חלק 1: בסיסי ואביזרים ---
            { id: 'p1_s1', part: '1', title: 'מסך ראשי עם תמונה ו-FAB', concept: 'מבוא למסכים ואלמנטים ויזואליים. הצגת תמונה (ImageView) משפרת את ממשק המשתמש (UI/UX) ומוסיפה חוויה ויזואלית. FAB (כפתור פעולה צף) מספק גישה מהירה לפעולה המרכזית.', code: `// MainActivity.java
public void init() {
    imageViewLogo = findViewById(R.id.imageViewLogo); // הנחה שיש ImageView עם ID זה
    fab = findViewById(R.id.fabStart);
    // ניתן להגדיר תמונה מ-drawable באופן פרוגרמטי אם רוצים:
    // imageViewLogo.setImageResource(R.drawable.my_app_logo);
    // ...
}`},
            { id: 'p1_s9', part: '1', title: 'שמירת נתונים ב-Shared Preferences', concept: 'שימוש ב-**SharedPreferences** הוא הרחבה חשובה. זו הדרך הפשוטה והקלה ביותר לשמור נתונים קטנים (כמו הגדרות או ציון אחרון) באופן פרטי במכשיר. **למה?** כי אין צורך במסד נתונים מלא לנתונים פשוטים, וזה מהיר מאוד.', code: `// שמירת נתון (לדוגמה, שם משתמש)
SharedPreferences sp = getSharedPreferences("userDetails", MODE_PRIVATE);
SharedPreferences.Editor editor = sp.edit();
editor.putString("email", userEmail);
editor.apply(); // או commit()

// קריאת נתון
String savedEmail = sp.getString("email", "guest");`},
            { id: 'p1_s18', part: '1', title: 'הוספת תפריט (Options Menu)', concept: 'התפריט מאפשר גישה לפעולות משניות (כגון הגדרות, אודות, הנחיות) מבלי להעמיס על המסך הראשי. **למה?** שיפור ניווט וארגון הפעולות. יש להבין את המתודות onCreateOptionsMenu ו-onOptionsItemSelected.', code: `// MainActivity.java
@Override
public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.main_menu, menu);
    return true;
}

@Override
public boolean onOptionsItemSelected(@NonNull MenuItem item) {
    int itemId = item.getItemId();
    if (itemId == R.id.mnuInstructions) {
        // מעבר למסך הנחיות באמצעות Intent
        Intent intent = new Intent(MainActivity.this, InstructionsActivity.class);
        startActivity(intent);
    }
    return super.onOptionsItemSelected(item);
}`},
            { id: 'p1_s19', part: '1', title: 'קריאת הנחיות מקובץ גולמי (Raw Resource)', concept: '**Raw Resources** - זו דרך קלה לשלב קבצים סטטיים (טקסט, מוזיקה) בתוך האפליקציה. **למה?** קובץ טקסט גולמי (R.raw.instructions) מאפשר לשמור תוכן גדול (כמו הנחיות למשתמש) בנפרד מהקוד, ולקרוא אותו בקלות לתוך TextView.', code: `// InstructionsActivity.java
public String readIntroductionsFromFile() {
    try {
        InputStream is = getResources().openRawResource(R.raw.instructions);
        InputStreamReader isr = new InputStreamReader(is);
        BufferedReader br = new BufferedReader(isr);
        StringBuilder all = new StringBuilder();
        String line;
        while ((line = br.readLine()) != null) {
            all.append(line).append("\\n");
        }
        br.close();
        isr.close();
        is.close();
        return all.toString();
    } catch (IOException e) {
        e.printStackTrace();
        return "שגיאה בטעינת הנחיות.";
    }
}`},

            // --- חלק 2: מסד נתונים SQLite ---
            { id: 'p2_s2', part: '2', title: 'יצירת מחלקת עזר HelperDB', concept: 'מחלקת ה-**SQLiteOpenHelper** היא **המתווך** בין האפליקציה למסד הנתונים. **למה?** היא מנהלת את יצירת מסד הנתונים הראשונית (onCreate) ואת עדכון המבנה שלו בעת הצורך (onUpgrade). היא מבטיחה שהאפליקציה תעבוד עם מבנה נתונים יציב.', code: `// HelperDB.java
public class HelperDB extends SQLiteOpenHelper {
    public HelperDB(Context context) {
        super(context, DATABASE_NAME, null, DATABASE_VERSION);
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        String createTableUsers = "CREATE TABLE " + USERS_TABLE + " (" +
                                  EMAIL_COL + " TEXT PRIMARY KEY, " +
                                  FIRST_NAME_COL + " TEXT, " +
                                  // ... שאר העמודות
                                  ");";
        db.execSQL(createTableUsers);
        // ... יצירת טבלת ציונים
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        db.execSQL("DROP TABLE IF EXISTS " + USERS_TABLE);
        onCreate(db);
    }
}`},
            { id: 'p2_s3', part: '2', title: 'רישום משתמש באמצעות מסד נתונים', concept: 'הוספת רשומת משתמש חדשה לטבלת המשתמשים. **למה?** השתמש ב-**ContentValues** כדי להבטיח אבטחה (מניעת SQL Injection) ונוחות בבניית השאילתה. זו הדרך המקובלת לשמירת נתונים ב-SQLite.', code: `// RegisterActivity.java
public void registerUser(UserProperties user) {
    SQLiteDatabase db = helperDB.getWritableDatabase();
    ContentValues cv = new ContentValues();
    cv.put(HelperDB.EMAIL_COL, user.getEmail());
    cv.put(HelperDB.FIRST_NAME_COL, user.getFirstName());
    // ... הוספת שאר הנתונים

    long newRowId = db.insert(HelperDB.USERS_TABLE, null, cv);
    // יש לבדוק אם newRowId == -1 (כישלון בהוספה)
}`},
            { id: 'p2_s5', part: '2', title: 'בדיקת התחברות משתמש', concept: 'שליפת נתונים ובדיקת תנאי התאמה. **למה?** יש להשתמש ב-**Cursor** כדי לעבור על התוצאות שהתקבלו מהשאילתה. **חשוב:** שימוש ב-`?` ב-`selectionArgs` מגן מפני SQL Injection ומבטיח שהקלט של המשתמש יטופל כערך ולא כחלק מהפקודה.', code: `// LoginActivity.java
public UserProperties checkLogin(String email, String password) {
    SQLiteDatabase db = helperDB.getReadableDatabase();
    String[] selectionArgs = {email, password};
    String selection = HelperDB.EMAIL_COL + "=? AND " + HelperDB.PASSWORD_COL + "=?";

    Cursor cursor = db.query(
        HelperDB.USERS_TABLE,
        null, // כל העמודות
        selection,
        selectionArgs,
        null, null, null
    );

    if (cursor.moveToFirst()) {
        // המשתמש נמצא, בצע שליפת נתונים ובדיקת כפילות
        cursor.close();
        return new UserProperties(...); // החזרת אובייקט משתמש
    }
    cursor.close();
    return null; // משתמש לא נמצא
}`},
            { id: 'p2_s10', part: '2', title: 'מחיקת משתמש', concept: 'מחיקת רשומה מטבלת המשתמשים. **למה?** כדי לאפשר למשתמש שליטה מלאה בנתונים שלו (דרישת פרטיות). יש להשתמש בפקודת db.delete() ולציין את תנאי המחיקה (WHERE). רצוי להשתמש בדיאלוג אישור (AlertDialog) לפני המחיקה.', code: `// UserSettingsActivity.java (חלק ממתודה גדולה יותר)
public void deleteUser(String email) {
    SQLiteDatabase db = helperDB.getWritableDatabase();
    String where = HelperDB.EMAIL_COL + "=?";
    String[] args = new String[]{email};

    // מחיקה מטבלת המשתמשים
    db.delete(HelperDB.USERS_TABLE, where, args);

    // מחיקה מטבלת הציונים (כדי למנוע נתונים יתומים)
    db.delete(HelperDB.SCORES_TABLE, where, args);

    // לאחר המחיקה, יש לבצע Intent חזרה למסך ההתחברות.
}`},

            // --- חלק 3: הרחבות ושיפורים ---
            { id: 'p3_s1', part: '3', title: 'הרחבה: TextToSpeech (אישור קולי)', concept: '**TextToSpeech (TTS)** זו הרחבה המשתמשת בשירות מערכת כדי להפוך טקסט לדיבור. **למה?** זו הרחבה חזקה המשתמשת ב-API חיצוני, מוסיפה נגישות ומקלה על אישור פעולות (כמו מחיקת משתמש), במיוחד כאשר הטקסט ארוך.', code: `// TextToSpeech
public TextToSpeech textToSpeech;
public Locale locale;

// אתחול בשלב מוקדם של האקטיביטי
textToSpeech = new TextToSpeech(getApplicationContext(), new TextToSpeech.OnInitListener() {
    @Override
    public void onInit(int status) {
        if (status == TextToSpeech.SUCCESS) {
            locale = new Locale("iw"); // "iw" עבור עברית
            textToSpeech.setLanguage(locale);
        }
    }
});

public void read(String message) {
    if (textToSpeech != null && lang != TextToSpeech.LANG_MISSING_DATA) {
        textToSpeech.speak(message, TextToSpeech.QUEUE_FLUSH, null);
    }
}

// יש לוודא שמשחררים את המשאבים ב-onDestroy()
@Override
protected void onDestroy() {
    if (textToSpeech != null) {
        textToSpeech.stop();
        textToSpeech.shutdown();
    }
    super.onDestroy();
}`},
            { id: 'p3_s5', part: '3', title: 'הרחבה: הורדת שאלות מהרשת (Async Task)', concept: '**Async Task** הוא מנגנון לביצוע פעולות **ארוכות** (כמו הורדת קובץ או גישה לבסיס נתונים רחוק) בחוט (Thread) נפרד מהחוט הראשי של ממשק המשתמש (UI Thread). **למה?** **אסור** לחסום את חוט הממשק הראשי! חסימה גורמת לאפליקציה "לקפוא" ול-ANR (Application Not Responding) - זהו נושא תיאורטי קריטי לבחינה!', code: `// מחלקת עזר פנימית
private class GetQuestionsFromInternet extends AsyncTask<String, Void, String> {

    @Override
    protected String doInBackground(String... urls) {
        // --- מתבצע בחוט הרקע (Background Thread) ---
        // כאן מתבצעת הפעולה החוסמת: קריאה ל-URL והורדת הנתונים.
        // אסור לעדכן UI כאן!
        // ... קוד HTTPURLConnection לקריאת נתונים
        return downloadedData;
    }

    @Override
    protected void onPostExecute(String result) {
        super.onPostExecute(result);
        // --- מתבצע בחוט הראשי (UI Thread) ---
        // כאן מותר לעדכן את ממשק המשתמש (לדוגמה, להציג את השאלה הראשונה)
        // ... ניתוח JSON (JSON Array/Object) מתוך ה-result
        // ... עדכון רשימת השאלות והצגת השאלה הראשונה
    }
}`},
            { id: 'p3_s4', part: '3', title: 'הרחבה: Broadcast Receiver (עצירת משחק בשיחה)', concept: 'ה-**Broadcast Receiver** הוא מנגנון שמאפשר לאפליקציה **להאזין** לאירועים שמשודרים על ידי המערכת (כמו שיחה נכנסת, סוללה חלשה, או התחברות ל-Wi-Fi). **למה?** כדי להגיב באופן מיידי לאירועים קריטיים של המערכת. במקרה זה, עצירת משחק כשיש שיחה נכנסת משפרת את חוויית המשתמש. **דרישת חובה:** יש להגדיר את ה-Receiver במניפסט ו/או לרשום אותו דינמית.', code: `// MyPhoneReceiver.java (מחלקת ה-Receiver)
public class MyPhoneReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(Context context, Intent intent) {
        // בודק אם הפעולה היא שיחת טלפון (ההרשאה נדרשת במניפסט)
        String state = intent.getStringExtra(TelephonyManager.EXTRA_STATE);

        if (state.equals(TelephonyManager.EXTRA_STATE_RINGING)) {
            // ... שליחת Broadcast מקומי לאקטיביטי המשחק כדי לעצור אותו
        }
        // ...
    }
}`},
        ];

        let activeStepId = stepsData[0].id;

        function loadStepDetails(stepId) {
            const step = stepsData.find(s => s.id === stepId);
            if (!step) return;

            // עדכון המשתנה הגלובלי
            activeStepId = stepId;

            document.getElementById('stepTitle').innerText = step.title;
            document.getElementById('stepConcept').innerHTML = `
                <h3 class="text-xl font-bold mb-2 text-primary-blue">הסבר קונספטואלי: למה?</h3>
                <p class="text-gray-700 leading-relaxed">${step.concept}</p>
            `;
            document.getElementById('stepCode').innerText = step.code;

            // עדכון כפתורי הניווט הפעילים
            document.querySelectorAll('.step-item').forEach(el => {
                el.classList.remove('active-step');
                if (el.dataset.stepId === stepId) {
                    el.classList.add('active-step');
                }
            });

            // במידה ואנחנו במובייל, גוללים למעלה לצפייה בפרטים
            if (window.innerWidth < 768) {
                document.getElementById('mainContent').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function copyCode() {
            const codeElement = document.getElementById('stepCode');
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                const button = document.getElementById('copyButton');
                const originalText = button.innerText;
                button.innerText = 'הועתק!';
                button.classList.add('bg-green-500', 'hover:bg-green-600');
                button.classList.remove('bg-gray-300', 'hover:bg-gray-400');
                setTimeout(() => {
                    button.innerText = originalText;
                    button.classList.remove('bg-green-500', 'hover:bg-green-600');
                    button.classList.add('bg-gray-300', 'hover:bg-gray-400');
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        function initializeApp() {
            const sidebar = document.getElementById('sidebarSteps');
            let currentPart = '';

            // יצירת רשימת הצעדים בסרגל הצד
            stepsData.forEach(step => {
                // הוספת כותרת חלק אם זהו חלק חדש
                if (step.part !== currentPart) {
                    currentPart = step.part;
                    const partHeader = document.createElement('h2');
                    partHeader.className = 'px-4 pt-4 pb-2 text-sm font-bold text-gray-800 border-t border-gray-200';
                    partHeader.innerText = `חלק ${step.part}: ${step.part === '1' ? 'בסיס' : step.part === '2' ? 'מסד נתונים' : 'הרחבות'}`;
                    sidebar.appendChild(partHeader);
                }

                const stepDiv = document.createElement('div');
                stepDiv.className = 'step-item cursor-pointer p-4 transition-all duration-200 hover:bg-gray-100 border-b border-gray-100 text-sm md:text-base';
                stepDiv.innerText = step.title;
                stepDiv.dataset.stepId = step.id;
                stepDiv.addEventListener('click', () => loadStepDetails(step.id));
                sidebar.appendChild(stepDiv);
            });

            // טעינת השלב הראשון כברירת מחדל
            if (stepsData.length > 0) {
                loadStepDetails(stepsData[0].id);
            }

            // קישור כפתור ההעתקה
            document.getElementById('copyButton').addEventListener('click', copyCode);
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- סרגל צד לניווט (Sidebar) --><aside id="sidebarSteps" class="w-full md:w-80 bg-white border-l border-gray-200 flex-shrink-0 custom-scrollbar overflow-y-auto">
            <header class="p-4 bg-primary-blue text-white shadow-lg sticky top-0 z-10">
                <h1 class="text-lg font-bold">📚 צעדים להבנה מלאה</h1>
                <p class="text-sm">לחץ על שלב כדי לראות קוד והסבר קונספטואלי</p>
            </header>
            <!-- הצעדים יוכנסו כאן על ידי JavaScript --></aside>

        <!-- תוכן ראשי (Main Content) --><main id="mainContent" class="flex-grow p-6 md:p-10 custom-scrollbar overflow-y-auto">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-6">כלי הלימוד לפרויקט הטריוויה: בגרות 5 יח"ל</h1>
            <p class="text-lg text-gray-600 mb-10">כאן תוכלו לראות את הצעד המדויק, את הקוד הדרוש לו, והכי חשוב - **את ההסבר הקונספטואלי** ("למה?") כדי להיות מוכנים לבחינת ההגנה.</p>

            <!-- כרטיס השלב הפעיל --><div class="bg-white rounded-xl shadow-2xl overflow-hidden p-6 md:p-8 border-t-8 border-primary-blue">
                <h2 id="stepTitle" class="text-2xl md:text-3xl font-extrabold mb-4 text-gray-800"></h2>

                <!-- הסבר קונספטואלי (ה"למה") --><div id="stepConcept" class="mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200 transition-all duration-300">
                    <!-- תוכן ההסבר יוכנס כאן --></div>

                <!-- קוד (ה"איך") --><div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-bold text-gray-800">קוד Java: איך מבצעים?</h3>
                        <button id="copyButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-200">
                            העתק קוד
                        </button>
                    </div>
                    <!-- הוספנו dir="ltr" לתגית pre כדי לכפות כיווניות משמאל לימין על הקוד --><pre dir="ltr" class="step-code p-4 rounded-lg text-sm md:text-base overflow-x-auto shadow-inner">
                        <code id="stepCode">
                            // קוד יוכנס כאן
                        </code>
                    </pre>
                </div>
            </div>

            <!-- טיפ בגרות נוסף --><div class="mt-10 p-6 bg-yellow-100 rounded-xl border border-yellow-300 shadow-lg">
                <h3 class="text-xl font-bold text-yellow-800 mb-2">💡 טיפ לבוחן (מבוסס שאלות מחוון)</h3>
                <p class="text-yellow-700">בבחינת ההגנה, הבוחן יבדוק **שליטה בקוד** ו**הבנה תיאורטית**. אם תתבקש להסביר קטע קוד, אל רק לקרוא אותו. הסבר: </p>
                <ul class="list-disc list-inside mt-2 space-y-1 text-yellow-700">
                    <li>**תפקיד:** מה הפעולה הזו עושה ברמה העסקית של האפליקציה (לדוגמה, "שומרת את הציון הסופי").</li>
                    <li>**טכנולוגיה:** איזה כלי טכנולוגי משמש כאן (לדוגמה, "אנו משתמשים ב-ContentValues של SQLite").</li>
                    <li>**הצדקה:** למה בחרת לעשות את זה כך (לדוגמה, "בחרתי ב-AsyncTask כדי לא לחסום את חוט הממשק הראשי").</li>
                </ul>
            </div>
        </main>
    </div>
</body>
</html>
